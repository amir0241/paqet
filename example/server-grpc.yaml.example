# paqet Server Configuration Example with gRPC
# This configuration uses gRPC protocol with HTTP/2 multiplexing
role: "server"

# Logging configuration
log:
  level: "info"  # none, debug, info, warn, error, fatal

# Server listen configuration
listen:
  addr: ":9999"   # CHANGE ME: Server listen port (must match network.ipv4.addr port)
                  # WARNING: Do not use standard ports (80, 443, etc.) as iptables rules
                  # can affect outgoing server connections.

# Network interface settings
network:
  interface: "eth0"                          # CHANGE ME: Network interface (eth0, ens3, en0, etc.)
  # guid: "\Device\NPF_{...}"                # Windows only (Npcap).

  # IPv4 configuration
  ipv4:
    addr: "10.0.0.100:9999"                  # CHANGE ME: Server IPv4 and port (port must match listen.addr)
    router_mac: "aa:bb:cc:dd:ee:ff"          # CHANGE ME: Gateway/router MAC address

  # TCP flags for packet crafting (optional - will use defaults)
  tcp:
    local_flag: ["PA"]                       # Local TCP flags (Push+Ack default)

# Transport protocol configuration - gRPC
transport:
  protocol: "grpc"  # Using gRPC transport with HTTP/2 multiplexing
  conn: 1           # Number of connections (1-256, default: 1)

  # gRPC protocol settings
  grpc:
    # Connection settings
    max_connection_idle: 300            # Maximum idle time before closing (seconds, default: 300)
    max_connection_age: 0               # Maximum connection age (0 = unlimited, default: 0)
    max_connection_age_grace: 0         # Grace period for active RPCs (0 = unlimited, default: 0)
    keep_alive_time: 7200               # Keep-alive ping interval (seconds, default: 7200)
    keep_alive_timeout: 20              # Keep-alive timeout (seconds, default: 20)
    
    # Stream settings
    max_concurrent_streams: 1000        # Maximum concurrent streams (default: 1000 for server)
    initial_window_size: 65535          # Initial stream window size (bytes, default: 64KB)
    initial_conn_window_size: 16777216  # Initial connection window size (bytes, default: 16MB)
    
    # Buffer sizes
    write_buffer_size: 32768            # Write buffer size (bytes, default: 32KB)
    read_buffer_size: 32768             # Read buffer size (bytes, default: 32KB)

# Important: Server Firewall Configuration Required!
# 
# Since paqet uses pcap to bypass standard firewalls, you MUST configure
# iptables on the server to prevent kernel interference:
#
# sudo iptables -t raw -A PREROUTING -p tcp --dport 9999 -j NOTRACK
# sudo iptables -t raw -A OUTPUT -p tcp --sport 9999 -j NOTRACK  
# sudo iptables -t mangle -A OUTPUT -p tcp --sport 9999 --tcp-flags RST RST -j DROP
#
# Replace 9999 with your actual listen port.
