# paqet Server Configuration Example  
# Role must be explicitly set
role: "server"

# Logging configuration
log:
  level: "info"  # none, debug, info, warn, error, fatal

# Server listen configuration
listen:
  addr: ":9999"   # CHANGE ME: Server listen port (must match network.ipv4.addr port)
                  # WARNING: Do not use standard ports (80, 443, etc.) as iptables rules
                  # can affect outgoing server connections.

# Network interface settings
network:
  interface: "eth0"                          # CHANGE ME: Network interface (eth0, ens3, en0, etc.)
  # guid: "\Device\NPF_{...}"                # Windows only (Npcap).

  # IPv4 configuration
  ipv4:
    addr: "10.0.0.100:9999"                  # CHANGE ME: Server IPv4 and port (port must match listen.addr)
    router_mac: "aa:bb:cc:dd:ee:ff"          # CHANGE ME: Gateway/router MAC address

  # IPv6 configuration (optional)
  # ipv6:
  #   addr: "[::1]:9999"                     # CHANGE ME: Server IPv6 and port
  #   router_mac: "aa:bb:cc:dd:ee:ff"        # CHANGE ME: Gateway/router MAC address

  # TCP flags for packet crafting (optional - will use defaults)
  tcp:
    local_flag: ["PA"]                       # Local TCP flags (Push+Ack default)

  # PCAP settings — all auto-tuned from RAM/CPU; override only if needed.
  # pcap:
  #   sockbuf: 33554432          # Socket buffer in bytes (auto: nextPow2(RAM/256 MB) MB, e.g. 32 MB on 8 GB)
  #   send_queue_size: 30000     # Send queue slots (auto: cpus×7500, e.g. 30000 on 4 cores)
  #   max_retries: 3
  #   initial_backoff_ms: 10
  #   max_backoff_ms: 1000

# Transport protocol configuration
# Buffer sizes (tcpbuf, udpbuf, tunbuf) are auto-tuned from CPU count — no need to set them.
transport:
  protocol: "kcp"  # Transport protocol: "kcp" or "quic"
  conn: 1          # Number of connections (1-256, default: 1)

  # Override buffer sizes only if you need to deviate from auto-tuned values:
  # tcpbuf: 65536   # auto: cpus×16 KB, e.g. 64 KB on 4 cores
  # udpbuf: 16384   # auto: cpus×4 KB,  e.g. 16 KB on 4 cores

  # KCP protocol settings (used when protocol: "kcp")
  kcp:
    mode: "fast"              # KCP mode: normal, fast, fast2, fast3, manual

    # Manual mode parameters (only used when mode="manual")
    # nodelay: 1
    # interval: 10
    # resend: 2
    # nocongestion: 1
    # wdelay: false
    # acknodelay: true
    # mtu: 1350

    # KCP window/buffer sizes are auto-tuned from CPU count — override only if needed:
    # rcvwnd: 8192            # auto: cpus×2048, e.g. 8192 on 4 cores
    # sndwnd: 8192            # auto: cpus×2048
    # smuxbuf: 4194304        # auto: cpus×1 MB,  e.g. 4 MB on 4 cores
    # streambuf: 4194304      # auto: cpus×1 MB

    # Encryption settings  
    # block: "aes"                    # aes, aes-128, aes-128-gcm, aes-192, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, xor, sm4, none, null
    key: "your-secret-key-here"       # CHANGE ME: Secret key (must match client)

  # QUIC protocol settings (used when protocol: "quic")
  # All QUIC stream/window settings are auto-tuned — see server-quic.yaml.example.
  # quic: {}

# Performance section is fully auto-tuned from CPU count; only override if needed:
# performance:
#   max_concurrent_streams: 50000    # auto: cpus×12500, e.g. 50000 on 4 cores
#   packet_workers: 4                # auto: GOMAXPROCS (capped at 64)
#   stream_worker_pool_size: 10000   # auto: cpus×2500
#   tcp_connection_pool_size: 500    # auto: cpus×125
#   tcp_connection_idle_timeout: 90
#   max_retry_attempts: 5
#   retry_initial_backoff_ms: 100
#   retry_max_backoff_ms: 10000

# Optional Forward Error Correction (FEC) - currently disabled
# Use only for very lossy networks:
#   dshard: 10    # Data shards for FEC  
#   pshard: 3     # Parity shards for FEC

# Important: Server Firewall Configuration Required!
# 
# Since paqet uses pcap to bypass standard firewalls, you MUST configure
# iptables on the server to prevent kernel interference:
#
# sudo iptables -t raw -A PREROUTING -p tcp --dport 9999 -j NOTRACK
# sudo iptables -t raw -A OUTPUT -p tcp --sport 9999 -j NOTRACK  
# sudo iptables -t mangle -A OUTPUT -p tcp --sport 9999 --tcp-flags RST RST -j DROP
#
# Replace 9999 with your actual listen port.